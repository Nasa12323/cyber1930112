<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCTNS IIF-3 Form Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: #1a2a6c;
            color: white;
            padding: clamp(15px, 3vw, 25px);
            text-align: center;
            border-bottom: 5px solid #fdbb2d;
        }

            header h1 {
                margin-bottom: 10px;
                font-size: clamp(22px, 4vw, 32px);
            }

            header p {
                font-size: clamp(14px, 2vw, 18px);
                opacity: 0.9;
            }

        .content {
            display: flex;
            flex-wrap: wrap;
            padding: clamp(15px, 3vw, 25px);
            gap: clamp(15px, 3vw, 25px);
        }

        .form-container {
            flex: 1;
            min-width: 300px;
            padding: clamp(15px, 3vw, 25px);
            background: #f9f9f9;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .preview-container {
            flex: 1;
            min-width: 300px;
            padding: clamp(15px, 3vw, 25px);
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }

        h2 {
            color: #1a2a6c;
            margin-bottom: clamp(15px, 3vw, 25px);
            padding-bottom: 10px;
            border-bottom: 2px solid #fdbb2d;
            font-size: clamp(18px, 3vw, 24px);
        }

        .form-group {
            margin-bottom: clamp(10px, 2vw, 15px);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
            font-size: clamp(14px, 2vw, 16px);
        }

        input, select, textarea {
            width: 100%;
            padding: clamp(8px, 1.5vw, 12px);
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: clamp(14px, 2vw, 16px);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background: #1a2a6c;
            color: white;
            border: none;
            padding: clamp(10px, 2vw, 15px);
            border-radius: 4px;
            cursor: pointer;
            font-size: clamp(14px, 2vw, 16px);
            font-weight: 600;
            margin-top: 10px;
            transition: background 0.3s;
            width: 100%;
        }

            button:hover {
                background: #2a3a8c;
            }

        .btn-export {
            background: #b21f1f;
        }

            .btn-export:hover {
                background: #c22f2f;
            }

        .btn-word {
            background: #1a6c5c;
        }

            .btn-word:hover {
                background: #2a7c6c;
            }

        .btn-ghost {
            background: #5f6368;
        }

            .btn-ghost:hover {
                background: #6f7378;
            }

        .btn-danger {
            background: #c62828;
        }

            .btn-danger:hover {
                background: #d63838;
            }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(8px, 1.5vw, 12px);
            margin-top: clamp(15px, 3vw, 25px);
        }

            .action-buttons button {
                flex: 1;
                min-width: 120px;
            }

        .form-preview {
            background: white;
            padding: clamp(15px, 3vw, 25px);
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: clamp(12px, 2vw, 14px);
            line-height: 1.5;
            font-family: "Times New Roman", serif;
        }

        .preview-header {
            text-align: center;
            margin-bottom: clamp(15px, 3vw, 25px);
            padding-bottom: 10px;
            border-bottom: 2px solid #1a2a6c;
        }

            .preview-header h3 {
                color: #1a2a6c;
                font-size: clamp(18px, 3vw, 24px);
            }

        .preview-section {
            margin-bottom: clamp(15px, 3vw, 25px);
        }

            .preview-section h4 {
                background: #f0f0f0;
                padding: clamp(6px, 1.5vw, 10px);
                margin-bottom: 10px;
                color: #1a2a6c;
                border-left: 4px solid #fdbb2d;
                font-size: clamp(14px, 2vw, 18px);
            }

        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: clamp(6px, 1.5vw, 10px);
            text-align: left;
        }

        th {
            background: #f0f0f0;
        }

        .footer {
            text-align: center;
            padding: clamp(15px, 3vw, 25px);
            background: #1a2a6c;
            color: white;
            margin-top: clamp(15px, 3vw, 25px);
        }

        .section-title {
            background: #1a2a6c;
            color: white;
            padding: clamp(8px, 1.5vw, 12px);
            margin: clamp(15px, 3vw, 25px) 0 10px 0;
            border-radius: 4px;
            cursor: pointer;
            font-size: clamp(14px, 2vw, 16px);
        }

        .section-content {
            display: none;
            padding: clamp(8px, 1.5vw, 12px);
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .active {
            display: block;
        }

        .checkbox-group {
            margin: 10px 0;
        }

            .checkbox-group label {
                display: inline;
                font-weight: normal;
            }

        .field-label {
            font-weight: 700;
            width: 220px;
            display: inline-block;
            color: #222;
        }

        .signature-area {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .signature-box {
            border-top: 1px solid #000;
            width: 250px;
            padding-top: 5px;
            text-align: center;
            margin-bottom: 10px;
        }

        .two-column {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(8px, 1.5vw, 12px);
            margin-bottom: clamp(8px, 1.5vw, 12px);
        }

            .two-column .form-group {
                flex: 1;
                min-width: 200px;
            }

        /* VOICE-TO-TEXT STYLES */
        .voice-input-wrapper {
            position: relative;
            width: 100%;
        }

        .voice-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: #1a6c5c;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .voice-btn:hover {
            background: #2a7c6c;
            transform: scale(1.1);
        }

        .voice-btn.listening {
            background: #c62828;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { 
                box-shadow: 0 0 0 0 rgba(198, 40, 40, 0.7); 
            }
            70% { 
                box-shadow: 0 0 0 10px rgba(198, 40, 40, 0); 
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(198, 40, 40, 0); 
            }
        }

        .voice-status {
            position: absolute;
            bottom: -25px;
            left: 0;
            font-size: 0.8rem;
            color: #1a6c5c;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .voice-status.show {
            opacity: 1;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .voice-command-hint {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }

            .form-container {
                margin-right: 0;
            }

            .action-buttons {
                flex-direction: column;
            }

                .action-buttons button {
                    width: 100%;
                }

            .signature-area {
                flex-direction: column;
                align-items: center;
            }

            .signature-box {
                width: 100%;
                max-width: 250px;
            }

            .two-column {
                flex-direction: column;
                gap: 0;
            }

            .voice-btn {
                right: 5px;
                top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CCTNS IIF-3 Form Generator</h1>
            <p>Crime Investigation Form - Complete with Enhanced Voice-to-Text Features</p>
        </header>

        <div class="content">
            <div class="form-container">
                <h2>IIF-3 Form Details</h2>

                <div class="section-title" onclick="toggleSection('basicInfo')">1. Basic Information</div>
                <div id="basicInfo" class="section-content active">
                    <div class="two-column">
                        <div class="form-group">
                            <label for="district">District</label>
                            <input type="text" id="district" placeholder="Enter district">
                        </div>

                        <div class="form-group">
                            <label for="policeStation">Police Station</label>
                            <input type="text" id="policeStation" placeholder="Enter police station">
                        </div>
                    </div>

                    <div class="two-column">
                        <div class="form-group">
                            <label for="firNo">FIR No.</label>
                            <input type="text" id="firNo" placeholder="Enter FIR number">
                        </div>

                        <div class="form-group">
                            <label for="firDate">Date</label>
                            <input type="date" id="firDate">
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('actsSections')">2. Acts & Sections</div>
                <div id="actsSections" class="section-content">
                    <div class="table-container">
                        <table id="actsTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Acts</th>
                                    <th>Sections</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Enter Act"></td>
                                    <td><input type="text" placeholder="Enter Section"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('actsTable')">Add New Row</button>
                </div>

                <div class="section-title" onclick="toggleSection('placeOfOccurrence')">3. Place of Occurrence</div>
                <div id="placeOfOccurrence" class="section-content">
                    <div class="form-group">
                        <label for="occurrenceAddress">Address of Occurrence</label>
                        <div class="voice-input-wrapper">
                            <textarea id="occurrenceAddress" placeholder="Enter complete address of occurrence location"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('occurrenceAddress')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-occurrenceAddress"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "house number", "street", "landmark", "city", "pin code"
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="occurrenceTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Name</th>
                                    <th>Relative Type</th>
                                    <th>Relative Name</th>
                                    <th>Address</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Name"></td>
                                    <td><input type="text" placeholder="Relative Type"></td>
                                    <td><input type="text" placeholder="Relative Name"></td>
                                    <td><input type="text" placeholder="Address"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('occurrenceTable')">Add New Row</button>
                </div>

                <div class="section-title" onclick="toggleSection('crimeType')">4. Type of Crime</div>
                <div id="crimeType" class="section-content">
                    <h4>I. Major Head</h4>
                    <div class="table-container">
                        <table id="majorHeadTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Major Head</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Major Head"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('majorHeadTable')">Add New Row</button>

                    <h4>II. Minor Head</h4>
                    <div class="table-container">
                        <table id="minorHeadTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Minor Head</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Minor Head"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('minorHeadTable')">Add New Row</button>

                    <h4>III. Modus Operandi</h4>
                    <div class="table-container">
                        <table id="modusOperandiTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Modus Operandi</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Modus Operandi"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('modusOperandiTable')">Add New Row</button>

                    <h4>IV. Conveyance(s) Used</h4>
                    <div class="table-container">
                        <table id="conveyanceTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Conveyance(s) Used</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Conveyance(s) Used"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('conveyanceTable')">Add New Row</button>

                    <h4>V. Character Assumed</h4>
                    <div class="table-container">
                        <table id="characterTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Character Assumed</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Character Assumed"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('characterTable')">Add New Row</button>

                    <h4>VI. Language/Dialect Used</h4>
                    <div class="table-container">
                        <table id="languageTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Language/Dialect Used</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Language/Dialect Used"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('languageTable')">Add New Row</button>

                    <h4>VII. Special Feature</h4>
                    <div class="table-container">
                        <table id="specialFeatureTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Special Feature</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Special Feature"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('specialFeatureTable')">Add New Row</button>

                    <h4>VIII. Type of Place of Occurrence</h4>
                    <div class="table-container">
                        <table id="placeTypeTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Type of Place of Occurrence</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Type of Place of Occurrence"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('placeTypeTable')">Add New Row</button>

                    <h4>IX. Type of Property Stolen</h4>
                    <div class="table-container">
                        <table id="propertyTypeTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Type of Property Stolen</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Type of Property Stolen"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('propertyTypeTable')">Add New Row</button>
                </div>

                <div class="section-title" onclick="toggleSection('victimDetails')">5. Particulars of the Victim(s)</div>
                <div id="victimDetails" class="section-content">
                    <div class="two-column">
                        <div class="form-group">
                            <label for="victimName">Name</label>
                            <input type="text" id="victimName" placeholder="Enter victim name">
                        </div>
                        <div class="form-group">
                            <label for="victimAge">Age</label>
                            <input type="text" id="victimAge" placeholder="Enter victim age">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="victimInfo">Victim Details</label>
                        <div class="voice-input-wrapper">
                            <textarea id="victimInfo" placeholder="Enter complete victim details including name, age, address, contact information"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('victimInfo')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-victimInfo"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "victim name", "age", "gender", "contact details", "injuries sustained"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('complainantInfo')">6. Complainant / Informant Details</div>
                <div id="complainantInfo" class="section-content">
                    <div class="two-column">
                        <div class="form-group">
                            <label for="complainantName">Name</label>
                            <input type="text" id="complainantName" placeholder="Enter name">
                        </div>
                        <div class="form-group">
                            <label for="complainantFather">Father's / Husband's Name</label>
                            <input type="text" id="complainantFather" placeholder="Enter father's/husband's name">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="complainantAddress">Address</label>
                        <div class="voice-input-wrapper">
                            <textarea id="complainantAddress" placeholder="Enter complete complainant address"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('complainantAddress')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-complainantAddress"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "house number", "street name", "area", "city", "pin code"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('accusedDetails')">7. Accused & Other Details</div>
                <div id="accusedDetails" class="section-content">
                    <div class="two-column">
                        <div class="form-group">
                            <label for="accusedName">Name</label>
                            <input type="text" id="accusedName" placeholder="Enter accused name">
                        </div>
                        <div class="form-group">
                            <label for="accusedAge">Age</label>
                            <input type="text" id="accusedAge" placeholder="Enter accused age">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="accusedDetailsText">Details of Accused Persons</label>
                        <div class="voice-input-wrapper">
                            <textarea id="accusedDetailsText" placeholder="Enter complete accused details including names, descriptions, roles in crime"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('accusedDetailsText')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-accusedDetailsText"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "suspect name", "age", "description", "clothing", "weapons used"
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="delayDetails">Reasons for Delay in Reporting</label>
                        <div class="voice-input-wrapper">
                            <textarea id="delayDetails" placeholder="Enter reasons for any delay in reporting the crime"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('delayDetails')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-delayDetails"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "fear", "threats", "unaware", "hospitalization", "witness unavailable"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('motive')">8. Motive of Crime</div>
                <div id="motive" class="section-content">
                    <div class="form-group">
                        <label for="motiveText">Motive Details</label>
                        <div class="voice-input-wrapper">
                            <textarea id="motiveText" placeholder="Enter detailed motive behind the crime"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('motiveText')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-motiveText"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "revenge", "financial gain", "personal dispute", "property dispute"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('stolenProperties')">9. Details of Properties Stolen</div>
                <div id="stolenProperties" class="section-content">
                    <div class="form-group">
                        <label for="propertyInfo">Property Particulars</label>
                        <div class="voice-input-wrapper">
                            <textarea id="propertyInfo" placeholder="Enter detailed description of stolen properties"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('propertyInfo')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-propertyInfo"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "cash amount", "jewelry description", "electronic devices", "vehicle details"
                        </div>
                    </div>

                    <div class="two-column">
                        <div class="form-group">
                            <label for="propertyValue">Estimated Value</label>
                            <input type="text" id="propertyValue" placeholder="Enter estimated value">
                        </div>
                        <div class="form-group">
                            <label for="propertyRecoveryStatus">Recovery Status</label>
                            <select id="propertyRecoveryStatus">
                                <option value="">Select Status</option>
                                <option value="recovered">Recovered</option>
                                <option value="partially-recovered">Partially Recovered</option>
                                <option value="not-recovered">Not Recovered</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('visitDetails')">10. Date and Time of Visit to the Place of Occurrence</div>
                <div id="visitDetails" class="section-content">
                    <div class="table-container">
                        <table id="visitTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Officer Name</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="date"></td>
                                    <td><input type="time"></td>
                                    <td><input type="text" placeholder="Officer Name"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('visitTable')">Add New Row</button>
                </div>

                <div class="section-title" onclick="toggleSection('placeDescription')">11. Description of the Place of Occurrence</div>
                <div id="placeDescription" class="section-content">
                    <div class="form-group">
                        <label for="placeDescriptionText">Detailed Description</label>
                        <div class="voice-input-wrapper">
                            <textarea id="placeDescriptionText" placeholder="Enter detailed description of place of occurrence"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('placeDescriptionText')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-placeDescriptionText"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "building type", "room layout", "access points", "neighborhood description"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('physicalEvidence')">12. Description of Physical Evidence</div>
                <div id="physicalEvidence" class="section-content">
                    <h4>Physical Evidence Details</h4>
                    <div class="form-group">
                        <label for="physicalEvidenceText">Evidence Collected</label>
                        <div class="voice-input-wrapper">
                            <textarea id="physicalEvidenceText" placeholder="Enter detailed description of physical evidence collected"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('physicalEvidenceText')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-physicalEvidenceText"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "fingerprints location", "weapons found", "clothing items", "footprints", "DNA samples"
                        </div>
                    </div>

                    <h4>Witness Details</h4>
                    <div class="table-container">
                        <table id="witnessTable">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Witness Name</th>
                                    <th>Address</th>
                                    <th>Contact No.</th>
                                    <th>Statement</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input type="text" placeholder="Witness Name"></td>
                                    <td><input type="text" placeholder="Address"></td>
                                    <td><input type="text" placeholder="Contact No."></td>
                                    <td><input type="text" placeholder="Statement Summary"></td>
                                    <td><button onclick="removeRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addNewRow('witnessTable')">Add New Row</button>
                </div>

                <div class="section-title" onclick="toggleSection('sketch')">13. Sketch / Map of the Place of Occurrence</div>
                <div id="sketch" class="section-content">
                    <div class="form-group">
                        <label for="sketchDetails">Sketch/Map Description</label>
                        <div class="voice-input-wrapper">
                            <textarea id="sketchDetails" placeholder="Enter detailed description of sketch/map"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('sketchDetails')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-sketchDetails"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "north direction", "measurements", "landmarks", "entry exit points", "scale"
                        </div>
                    </div>

                    <div class="two-column">
                        <div class="checkbox-group">
                            <input type="checkbox" id="draftsmanPrepared">
                            <label for="draftsmanPrepared">Whether the Sketch/Map prepared by draftsman?</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="sketchAttached">
                            <label for="sketchAttached">Sketch/Map attached to file?</label>
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('firContents')">14. FIR Contents</div>
                <div id="firContents" class="section-content">
                    <div class="form-group">
                        <label for="firText">FIR Detailed Contents</label>
                        <div class="voice-input-wrapper">
                            <textarea id="firText" placeholder="Enter complete FIR contents and narrative"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('firText')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-firText"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "incident description", "sequence of events", "witness statements", "evidence details"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('actionTaken')">15. Action Taken Details</div>
                <div id="actionTaken" class="section-content">
                    <div class="form-group">
                        <label for="actionDetails">Investigation Actions</label>
                        <div class="voice-input-wrapper">
                            <textarea id="actionDetails" placeholder="Enter detailed actions taken during investigation"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('actionDetails')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-actionDetails"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "investigation started", "suspect detained", "evidence secured", "witness interviewed"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('gist')">16. Gist of Investigation</div>
                <div id="gist" class="section-content">
                    <div class="form-group">
                        <label for="gistText">Investigation Summary</label>
                        <div class="voice-input-wrapper">
                            <textarea id="gistText" placeholder="Enter comprehensive gist of the investigation"></textarea>
                            <button class="voice-btn" onclick="toggleVoiceInput('gistText')">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div class="voice-status" id="status-gistText"></div>
                        </div>
                        <div class="voice-command-hint">
                            Try saying: "summary of findings", "key evidence", "suspect identification", "case status"
                        </div>
                    </div>
                </div>

                <div class="section-title" onclick="toggleSection('signature')">Signature Details</div>
                <div id="signature" class="section-content">
                    <div class="two-column">
                        <div class="form-group">
                            <label for="investigationOfficer">Signature of the Investigation Officer</label>
                            <input type="text" id="investigationOfficer" placeholder="Enter officer name">
                        </div>

                        <div class="form-group">
                            <label for="officerName">Name</label>
                            <input type="text" id="officerName" placeholder="Enter officer name">
                        </div>
                    </div>

                    <div class="two-column">
                        <div class="form-group">
                            <label for="officerRank">Rank</label>
                            <input type="text" id="officerRank" placeholder="Enter officer rank">
                        </div>

                        <div class="form-group">
                            <label for="officerNo">No.</label>
                            <input type="text" id="officerNo" placeholder="Enter officer number">
                        </div>
                    </div>

                    <div class="two-column">
                        <div class="form-group">
                            <label for="completionDate">Date</label>
                            <input type="date" id="completionDate">
                        </div>
                        <div class="form-group">
                            <label for="stationName">Station Name</label>
                            <input type="text" id="stationName" placeholder="Enter station name">
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="btnGenerate">Generate Preview</button>
                    <button id="btnExport" class="btn-export">Export as PDF</button>
                    <button id="btnExportWord" class="btn-word">Export as Word</button>
                    <button id="btnSave" class="btn-ghost">Save to Records</button>
                    <button id="btnLoad" class="btn-ghost">Load Saved</button>
                    <button id="btnDelete" class="btn-danger">Delete Saved</button>
                </div>
            </div>

            <div class="preview-container">
                <h2>IIF-3 Form Preview</h2>
                <div id="formPreview" class="form-preview">
                    <div class="preview-header">
                        <h3>CCTNS IIF-3 Form</h3>
                        <p>Crime Investigation Report with Enhanced Voice-to-Text</p>
                    </div>

                    <!-- Preview content will be generated here -->
                    <div class="preview-section">
                        <h4>1. Basic Information</h4>
                        <p><strong>District:</strong> <span id="previewDistrict">Not specified</span></p>
                        <p><strong>Police Station:</strong> <span id="previewPoliceStation">Not specified</span></p>
                        <p><strong>FIR No.:</strong> <span id="previewFirNo">Not specified</span></p>
                        <p><strong>Date:</strong> <span id="previewFirDate">Not specified</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>3. Place of Occurrence</h4>
                        <p><strong>Address:</strong> <span id="previewOccurrenceAddress">Not specified</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>5. Particulars of the Victim(s)</h4>
                        <p><strong>Name:</strong> <span id="previewVictimName">Not specified</span></p>
                        <p><strong>Age:</strong> <span id="previewVictimAge">Not specified</span></p>
                        <p><strong>Details:</strong> <span id="previewVictimInfo">Not specified</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>6. Complainant / Informant Details</h4>
                        <p><strong>Name:</strong> <span id="previewComplainantName">Not specified</span></p>
                        <p><strong>Father's/Husband's Name:</strong> <span id="previewComplainantFather">Not specified</span></p>
                        <p><strong>Address:</strong> <span id="previewComplainantAddress">Not specified</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>7. Accused & Other Details</h4>
                        <p><strong>Name:</strong> <span id="previewAccusedName">Not specified</span></p>
                        <p><strong>Age:</strong> <span id="previewAccusedAge">Not specified</span></p>
                        <p><strong>Accused Details:</strong> <span id="previewAccusedDetails">Not specified</span></p>
                        <p><strong>Delay Reasons:</strong> <span id="previewDelayDetails">Not specified</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>8. Motive of Crime</h4>
                        <p id="previewMotiveText">Not specified</p>
                    </div>

                    <div class="preview-section">
                        <h4>9. Details of Properties Stolen</h4>
                        <p><strong>Property Particulars:</strong> <span id="previewPropertyInfo">Not specified</span></p>
                        <p><strong>Estimated Value:</strong> <span id="previewPropertyValue">Not specified</span></p>
                        <p><strong>Recovery Status:</strong> <span id="previewPropertyRecoveryStatus">Not specified</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>11. Description of the Place of Occurrence</h4>
                        <p id="previewPlaceDescription">Not specified</p>
                    </div>

                    <div class="preview-section">
                        <h4>12. Description of Physical Evidence</h4>
                        <p id="previewPhysicalEvidence">Not specified</p>
                    </div>

                    <div class="preview-section">
                        <h4>13. Sketch / Map of the Place of Occurrence</h4>
                        <p id="previewSketchDetails">Not specified</p>
                        <p><strong>Prepared by draftsman:</strong> <span id="previewDraftsman">No</span></p>
                        <p><strong>Sketch attached to file:</strong> <span id="previewSketchAttached">No</span></p>
                    </div>

                    <div class="preview-section">
                        <h4>14. FIR Contents</h4>
                        <p id="previewFirText">Not specified</p>
                    </div>

                    <div class="preview-section">
                        <h4>15. Action Taken Details</h4>
                        <p id="previewActionDetails">Not specified</p>
                    </div>

                    <div class="preview-section">
                        <h4>16. Gist of Investigation</h4>
                        <p id="previewGistText">Not specified</p>
                    </div>

                    <div class="preview-section">
                        <h4>Signature Details</h4>
                        <p><strong>Investigation Officer:</strong> <span id="previewInvestigationOfficer">Not specified</span></p>
                        <p><strong>Name:</strong> <span id="previewOfficerName">Not specified</span></p>
                        <p><strong>Rank:</strong> <span id="previewOfficerRank">Not specified</span></p>
                        <p><strong>No.:</strong> <span id="previewOfficerNo">Not specified</span></p>
                        <p><strong>Date:</strong> <span id="previewCompletionDate">Not specified</span></p>
                        <p><strong>Station Name:</strong> <span id="previewStationName">Not specified</span></p>
                    </div>

                    <div class="signature-area">
                        <div class="signature-box">Signature of Investigation Officer</div>
                        <div class="signature-box">Signature of Supervising Officer</div>
                    </div>

                    <div class="preview-section">
                        <p>Generated on: <span id="generationDate"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2023 CCTNS System | For official use only</p>
        </div>
    </div>

    <script>
        // Voice Recognition System
        class VoiceToTextSystem {
            constructor() {
                this.recognition = null;
                this.isListening = false;
                this.currentField = null;
                this.finalTranscript = '';
                this.initSpeechRecognition();
            }

            initSpeechRecognition() {
                // Check browser support
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    this.showError('Voice recognition is not supported in this browser. Please use Chrome or Edge.');
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = 'en-IN';

                this.recognition.onstart = () => {
                    this.isListening = true;
                    this.updateUI('listening', 'Listening... Speak now');
                };

                this.recognition.onresult = (event) => {
                    let interimTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            this.finalTranscript += this.formatPoliceText(event.results[i][0].transcript);
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }
                    
                    this.updateTextArea(this.finalTranscript + interimTranscript);
                };

                this.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    this.updateUI('error', `Error: ${event.error}`);
                    this.stopListening();
                };

                this.recognition.onend = () => {
                    this.stopListening();
                };
            }

            startListening(fieldId) {
                if (this.isListening) {
                    this.stopListening();
                    return;
                }

                this.currentField = fieldId;
                this.finalTranscript = document.getElementById(fieldId).value || '';
                
                try {
                    this.recognition.start();
                    this.updateUI('listening', 'Listening... Speak now');
                } catch (error) {
                    this.updateUI('error', 'Cannot start voice recognition');
                }
            }

            stopListening() {
                this.isListening = false;
                this.updateUI('stopped', 'Click microphone to speak');
                if (this.recognition) {
                    this.recognition.stop();
                }
            }

            updateTextArea(text) {
                if (this.currentField) {
                    const textarea = document.getElementById(this.currentField);
                    if (textarea) {
                        textarea.value = text;
                        // Auto-scroll to bottom
                        textarea.scrollTop = textarea.scrollHeight;
                    }
                }
            }

            formatPoliceText(text) {
                // Enhanced formatting for police documentation
                let formatted = text;
                
                // Voice commands for punctuation
                formatted = formatted.replace(/\bfull stop\b/gi, '.');
                formatted = formatted.replace(/\bcomma\b/gi, ',');
                formatted = formatted.replace(/\bquestion mark\b/gi, '?');
                formatted = formatted.replace(/\bexclamation mark\b/gi, '!');
                formatted = formatted.replace(/\bnew paragraph\b/gi, '\n\n');
                formatted = formatted.replace(/\bnew line\b/gi, '\n');
                
                // Auto-capitalize sentences
                formatted = formatted.replace(/(^\s*|[.!?]\s+)([a-z])/g, (match, p1, p2) => p1 + p2.toUpperCase());
                
                // Police-specific formatting
                formatted = formatted.replace(/\b(\d+)\s*(?:hours?|hrs?)\b/gi, '$1 hours');
                formatted = formatted.replace(/\b(\d+)\s*(?:minutes?|mins?)\b/gi, '$1 minutes');
                formatted = formatted.replace(/\b(\d+)\s*(?:meters?|mtrs?)\b/gi, '$1 meters');
                
                // Date and time patterns
                formatted = formatted.replace(/\b(\d{1,2})\s*(?:slash|\/)\s*(\d{1,2})\s*(?:slash|\/)\s*(\d{4})\b/gi, '$1/$2/$3');
                formatted = formatted.replace(/\b(\d{1,2})\s*(?:colon|:)\s*(\d{2})\s*(?:am|pm)\b/gi, (match, hour, minute) => {
                    return `${hour}:${minute} ${match.includes('pm') ? 'PM' : 'AM'}`;
                });
                
                return formatted;
            }

            updateUI(state, message) {
                if (!this.currentField) return;

                const button = document.querySelector(`[onclick="toggleVoiceInput('${this.currentField}")]`);
                const status = document.getElementById(`status-${this.currentField}`);

                if (button) {
                    button.classList.remove('listening');
                    if (state === 'listening') {
                        button.classList.add('listening');
                        button.innerHTML = '<i class="fas fa-circle"></i>';
                    } else {
                        button.innerHTML = '<i class="fas fa-microphone"></i>';
                    }
                }

                if (status) {
                    status.textContent = message;
                    status.classList.remove('show');
                    if (message) {
                        setTimeout(() => status.classList.add('show'), 100);
                    }
                }
            }

            showError(message) {
                alert(message);
            }
        }

        // Initialize voice system
        const voiceSystem = new VoiceToTextSystem();

        // Toggle function for buttons
        function toggleVoiceInput(fieldId) {
            voiceSystem.startListening(fieldId);
        }

        // ==================== FORM FUNCTIONS ====================
        document.addEventListener('DOMContentLoaded', function () {
            // Set current date
            const now = new Date();
            document.getElementById('generationDate').textContent = now.toLocaleString();
            document.getElementById('firDate').valueAsDate = now;
            document.getElementById('completionDate').valueAsDate = now;

            // Generate preview button
            document.getElementById('btnGenerate').addEventListener('click', generatePreview);

            // Export as PDF button
            document.getElementById('btnExport').addEventListener('click', exportAsPDF);

            // Export as Word button
            document.getElementById('btnExportWord').addEventListener('click', exportAsWord);

            // Save to Records button
            document.getElementById('btnSave').addEventListener('click', saveToRecords);

            // Load form button
            document.getElementById('btnLoad').addEventListener('click', loadFormLocal);

            // Delete form button
            document.getElementById('btnDelete').addEventListener('click', deleteFormLocal);

            // Generate initial preview
            generatePreview();
        });

        function generatePreview() {
            // Get all form values
            const district = document.getElementById('district').value || 'Not specified';
            const policeStation = document.getElementById('policeStation').value || 'Not specified';
            const firNo = document.getElementById('firNo').value || 'Not specified';
            const firDate = document.getElementById('firDate').value;
            const occurrenceAddress = document.getElementById('occurrenceAddress').value || 'Not specified';
            const victimName = document.getElementById('victimName').value || 'Not specified';
            const victimAge = document.getElementById('victimAge').value || 'Not specified';
            const victimInfo = document.getElementById('victimInfo').value || 'Not specified';
            const complainantName = document.getElementById('complainantName').value || 'Not specified';
            const complainantFather = document.getElementById('complainantFather').value || 'Not specified';
            const complainantAddress = document.getElementById('complainantAddress').value || 'Not specified';
            const accusedName = document.getElementById('accusedName').value || 'Not specified';
            const accusedAge = document.getElementById('accusedAge').value || 'Not specified';
            const accusedDetails = document.getElementById('accusedDetailsText').value || 'Not specified';
            const delayDetails = document.getElementById('delayDetails').value || 'Not specified';
            const motiveText = document.getElementById('motiveText').value || 'Not specified';
            const propertyInfo = document.getElementById('propertyInfo').value || 'Not specified';
            const propertyValue = document.getElementById('propertyValue').value || 'Not specified';
            const propertyRecoveryStatus = document.getElementById('propertyRecoveryStatus').value || 'Not specified';
            const placeDescriptionText = document.getElementById('placeDescriptionText').value || 'Not specified';
            const physicalEvidenceText = document.getElementById('physicalEvidenceText').value || 'Not specified';
            const sketchDetails = document.getElementById('sketchDetails').value || 'Not specified';
            const firText = document.getElementById('firText').value || 'Not specified';
            const actionDetails = document.getElementById('actionDetails').value || 'Not specified';
            const gistText = document.getElementById('gistText').value || 'Not specified';
            const draftsmanPrepared = document.getElementById('draftsmanPrepared').checked;
            const sketchAttached = document.getElementById('sketchAttached').checked;
            const investigationOfficer = document.getElementById('investigationOfficer').value || 'Not specified';
            const officerName = document.getElementById('officerName').value || 'Not specified';
            const officerRank = document.getElementById('officerRank').value || 'Not specified';
            const officerNo = document.getElementById('officerNo').value || 'Not specified';
            const completionDate = document.getElementById('completionDate').value;
            const stationName = document.getElementById('stationName').value || 'Not specified';

            // Format dates
            const formattedFirDate = firDate ? new Date(firDate).toLocaleDateString('en-GB') : 'Not specified';
            const formattedCompletionDate = completionDate ? new Date(completionDate).toLocaleDateString('en-GB') : 'Not specified';

            // Update all preview elements
            document.getElementById('previewDistrict').textContent = district;
            document.getElementById('previewPoliceStation').textContent = policeStation;
            document.getElementById('previewFirNo').textContent = firNo;
            document.getElementById('previewFirDate').textContent = formattedFirDate;
            document.getElementById('previewOccurrenceAddress').textContent = occurrenceAddress;
            document.getElementById('previewVictimName').textContent = victimName;
            document.getElementById('previewVictimAge').textContent = victimAge;
            document.getElementById('previewVictimInfo').textContent = victimInfo;
            document.getElementById('previewComplainantName').textContent = complainantName;
            document.getElementById('previewComplainantFather').textContent = complainantFather;
            document.getElementById('previewComplainantAddress').textContent = complainantAddress;
            document.getElementById('previewAccusedName').textContent = accusedName;
            document.getElementById('previewAccusedAge').textContent = accusedAge;
            document.getElementById('previewAccusedDetails').textContent = accusedDetails;
            document.getElementById('previewDelayDetails').textContent = delayDetails;
            document.getElementById('previewMotiveText').textContent = motiveText;
            document.getElementById('previewPropertyInfo').textContent = propertyInfo;
            document.getElementById('previewPropertyValue').textContent = propertyValue;
            document.getElementById('previewPropertyRecoveryStatus').textContent = propertyRecoveryStatus;
            document.getElementById('previewPlaceDescription').textContent = placeDescriptionText;
            document.getElementById('previewPhysicalEvidence').textContent = physicalEvidenceText;
            document.getElementById('previewSketchDetails').textContent = sketchDetails;
            document.getElementById('previewFirText').textContent = firText;
            document.getElementById('previewActionDetails').textContent = actionDetails;
            document.getElementById('previewGistText').textContent = gistText;
            document.getElementById('previewDraftsman').textContent = draftsmanPrepared ? 'Yes' : 'No';
            document.getElementById('previewSketchAttached').textContent = sketchAttached ? 'Yes' : 'No';
            document.getElementById('previewInvestigationOfficer').textContent = investigationOfficer;
            document.getElementById('previewOfficerName').textContent = officerName;
            document.getElementById('previewOfficerRank').textContent = officerRank;
            document.getElementById('previewOfficerNo').textContent = officerNo;
            document.getElementById('previewCompletionDate').textContent = formattedCompletionDate;
            document.getElementById('previewStationName').textContent = stationName;

            // Update generation date
            document.getElementById('generationDate').textContent = new Date().toLocaleString();
        }

        function exportAsPDF() {
            generatePreview();
            const element = document.getElementById('formPreview');
            const opt = {
                margin: 10,
                filename: 'iif-3-form.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function exportAsWord() {
            generatePreview();
            const htmlContent = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office"
                      xmlns:w="urn:schemas-microsoft-com:office:word"
                      xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="utf-8">
                    <title>IIF-3 Form</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.5; }
                        h1, h2, h3, h4 { color: #1a2a6c; }
                        h1 { font-size: 16pt; text-align: center; }
                        h2 { font-size: 14pt; margin-top: 12pt; margin-bottom: 6pt; }
                        table { width: 100%; border-collapse: collapse; margin: 6pt 0; }
                        th, td { border: 1px solid #000; padding: 4pt; text-align: left; }
                        th { background-color: #f3f6fb; font-weight: bold; }
                        .signature-area { margin-top: 30pt; display: flex; justify-content: space-between; }
                        .signature-box { border-top: 1px solid #000; width: 250px; padding-top: 5px; text-align: center; }
                    </style>
                </head>
                <body>
                    <h1>IIF-3 Form</h1>
                    <p style="text-align: center; font-style: italic;">Crime Investigation Report</p>
                    ${document.getElementById('formPreview').innerHTML}
                </body>
                </html>
            `;
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `IIF3_Form_${document.getElementById('firNo').value || 'report'}.doc`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('active');
        }

        function addNewRow(tableId) {
            const table = document.getElementById(tableId);
            const rowCount = table.rows.length;
            const row = table.insertRow(-1);
            const serialCell = row.insertCell(0);
            serialCell.innerHTML = rowCount;

            if (tableId === 'actsTable') {
                const cell1 = row.insertCell(1);
                const cell2 = row.insertCell(2);
                const cell3 = row.insertCell(3);
                cell1.innerHTML = '<input type="text" placeholder="Enter Act">';
                cell2.innerHTML = '<input type="text" placeholder="Enter Section">';
                cell3.innerHTML = '<button onclick="removeRow(this)">Remove</button>';
            } else if (tableId === 'occurrenceTable') {
                const cell1 = row.insertCell(1);
                const cell2 = row.insertCell(2);
                const cell3 = row.insertCell(3);
                const cell4 = row.insertCell(4);
                const cell5 = row.insertCell(5);
                cell1.innerHTML = '<input type="text" placeholder="Name">';
                cell2.innerHTML = '<input type="text" placeholder="Relative Type">';
                cell3.innerHTML = '<input type="text" placeholder="Relative Name">';
                cell4.innerHTML = '<input type="text" placeholder="Address">';
                cell5.innerHTML = '<button onclick="removeRow(this)">Remove</button>';
            } else if (tableId === 'visitTable') {
                const cell1 = row.insertCell(1);
                const cell2 = row.insertCell(2);
                const cell3 = row.insertCell(3);
                const cell4 = row.insertCell(4);
                cell1.innerHTML = '<input type="date">';
                cell2.innerHTML = '<input type="time">';
                cell3.innerHTML = '<input type="text" placeholder="Officer Name">';
                cell4.innerHTML = '<button onclick="removeRow(this)">Remove</button>';
            } else if (tableId === 'witnessTable') {
                const cell1 = row.insertCell(1);
                const cell2 = row.insertCell(2);
                const cell3 = row.insertCell(3);
                const cell4 = row.insertCell(4);
                const cell5 = row.insertCell(5);
                cell1.innerHTML = '<input type="text" placeholder="Witness Name">';
                cell2.innerHTML = '<input type="text" placeholder="Address">';
                cell3.innerHTML = '<input type="text" placeholder="Contact No.">';
                cell4.innerHTML = '<input type="text" placeholder="Statement Summary">';
                cell5.innerHTML = '<button onclick="removeRow(this)">Remove</button>';
            } else {
                const cell1 = row.insertCell(1);
                const cell2 = row.insertCell(2);
                cell1.innerHTML = '<input type="text">';
                cell2.innerHTML = '<button onclick="removeRow(this)">Remove</button>';
            }
        }

        function removeRow(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            const table = row.parentNode.parentNode;
            for (let i = 1; i < table.rows.length; i++) {
                table.rows[i].cells[0].innerHTML = i;
            }
        }

        // Local storage functions
        function saveToRecords() {
            generatePreview();
            const formData = collectFormData();
            localStorage.setItem('iif3Form', JSON.stringify(formData));
            alert('Form saved to records successfully!');
        }

        function loadFormLocal() {
            const raw = localStorage.getItem('iif3Form');
            if (!raw) {
                alert('No saved form found.');
                return;
            }
            try {
                const data = JSON.parse(raw);
                // Restore all form fields
                document.getElementById('district').value = data.district || '';
                document.getElementById('policeStation').value = data.policeStation || '';
                document.getElementById('firNo').value = data.firNo || '';
                document.getElementById('firDate').value = data.firDate || '';
                document.getElementById('occurrenceAddress').value = data.occurrenceAddress || '';
                document.getElementById('victimName').value = data.victimName || '';
                document.getElementById('victimAge').value = data.victimAge || '';
                document.getElementById('victimInfo').value = data.victimInfo || '';
                document.getElementById('complainantName').value = data.complainantName || '';
                document.getElementById('complainantFather').value = data.complainantFather || '';
                document.getElementById('complainantAddress').value = data.complainantAddress || '';
                document.getElementById('accusedName').value = data.accusedName || '';
                document.getElementById('accusedAge').value = data.accusedAge || '';
                document.getElementById('accusedDetailsText').value = data.accusedDetails || '';
                document.getElementById('delayDetails').value = data.delayDetails || '';
                document.getElementById('motiveText').value = data.motiveText || '';
                document.getElementById('propertyInfo').value = data.propertyInfo || '';
                document.getElementById('propertyValue').value = data.propertyValue || '';
                document.getElementById('propertyRecoveryStatus').value = data.propertyRecoveryStatus || '';
                document.getElementById('placeDescriptionText').value = data.placeDescriptionText || '';
                document.getElementById('physicalEvidenceText').value = data.physicalEvidenceText || '';
                document.getElementById('sketchDetails').value = data.sketchDetails || '';
                document.getElementById('firText').value = data.firText || '';
                document.getElementById('actionDetails').value = data.actionDetails || '';
                document.getElementById('gistText').value = data.gistText || '';
                document.getElementById('draftsmanPrepared').checked = data.draftsmanPrepared || false;
                document.getElementById('sketchAttached').checked = data.sketchAttached || false;
                document.getElementById('investigationOfficer').value = data.investigationOfficer || '';
                document.getElementById('officerName').value = data.officerName || '';
                document.getElementById('officerRank').value = data.officerRank || '';
                document.getElementById('officerNo').value = data.officerNo || '';
                document.getElementById('completionDate').value = data.completionDate || '';
                document.getElementById('stationName').value = data.stationName || '';
                generatePreview();
                alert('Saved form loaded.');
            } catch (error) {
                alert("Error loading saved form.");
            }
        }

        function deleteFormLocal() {
            if (!confirm('Delete locally saved form?')) return;
            localStorage.removeItem('iif3Form');
            alert('Saved form deleted.');
        }

        function collectFormData() {
            return {
                district: document.getElementById('district').value,
                policeStation: document.getElementById('policeStation').value,
                firNo: document.getElementById('firNo').value,
                firDate: document.getElementById('firDate').value,
                occurrenceAddress: document.getElementById('occurrenceAddress').value,
                victimName: document.getElementById('victimName').value,
                victimAge: document.getElementById('victimAge').value,
                victimInfo: document.getElementById('victimInfo').value,
                complainantName: document.getElementById('complainantName').value,
                complainantFather: document.getElementById('complainantFather').value,
                complainantAddress: document.getElementById('complainantAddress').value,
                accusedName: document.getElementById('accusedName').value,
                accusedAge: document.getElementById('accusedAge').value,
                accusedDetails: document.getElementById('accusedDetailsText').value,
                delayDetails: document.getElementById('delayDetails').value,
                motiveText: document.getElementById('motiveText').value,
                propertyInfo: document.getElementById('propertyInfo').value,
                propertyValue: document.getElementById('propertyValue').value,
                propertyRecoveryStatus: document.getElementById('propertyRecoveryStatus').value,
                placeDescriptionText: document.getElementById('placeDescriptionText').value,
                physicalEvidenceText: document.getElementById('physicalEvidenceText').value,
                sketchDetails: document.getElementById('sketchDetails').value,
                firText: document.getElementById('firText').value,
                actionDetails: document.getElementById('actionDetails').value,
                gistText: document.getElementById('gistText').value,
                draftsmanPrepared: document.getElementById('draftsmanPrepared').checked,
                sketchAttached: document.getElementById('sketchAttached').checked,
                investigationOfficer: document.getElementById('investigationOfficer').value,
                officerName: document.getElementById('officerName').value,
                officerRank: document.getElementById('officerRank').value,
                officerNo: document.getElementById('officerNo').value,
                completionDate: document.getElementById('completionDate').value,
                stationName: document.getElementById('stationName').value
            };
        }

        // Make functions global
        window.removeRow = removeRow;
        window.addNewRow = addNewRow;
        window.toggleSection = toggleSection;
        window.toggleVoiceInput = toggleVoiceInput;
    </script>
</body>
</html>
